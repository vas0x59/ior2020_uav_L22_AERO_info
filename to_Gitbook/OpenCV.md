## Цветные маркеры
```l22_aero_vision/src/color_r_c.py```

Для обработки изображения с камеры и детектирования объектов мы использовали функции из библиотеки OpenCV.

Алгоритм

1. Получение изображения и параметров камеры
1. Построение маски по определенному диапазону цветов (в формате HSV)
1. Детектирование контуров цветных объектов
1. Определение типа объекта, получение ключевых точек объекта на изображении
1. Определение положения квадратов и кругов с помощью solvePnP основываясь на реальных размерах объектов и точках на изображении ( [OpenCV Docs](https://docs.opencv.org/3.4/d9/d0c/group__calib3d.html#ga549c2075fac14829ff4a58bc931c033d) )
1. Отправка результата в топики ```/l22_aero_color/markers```  и  ```/l22_aero_color/circles``` ( координаты относительно main_camera_optical )

Во время разработки были созданы свои типы сообщений, а также сервис для настройки параметров детектора во время посадки. (ColorMarker, ColorMarkerArray, SetParameters). 
Для определения положения цветных объектов в системе координат поля была использована библиотека TF ([http://wiki.ros.org/tf](http://wiki.ros.org/tf))
Из-за искажений по краем изображения от fisheye объектива все распознанные контуры находящийся рядом с краем изображения игнорируются.
Во время посадки данный фильтр отключается.
Определение типа объекта производиться с помощь функций анализа контуров (approxPolyDP - кол-во вершин; minAreaRect, counturArea - соотношение площади описанного квадрата и площади контура + соотношение сторон).

<!-- IMAGE or VIDEO -->
<img src="https://github.com/vas0x59/ior2020_uav_L22_AERO_info/raw/master/to_Gitbook/content/5_D1_2.png" height="355">
<video id="v1" autoplay preload="auto" loop height="360" controls src="https://github.com/vas0x59/ior2020_uav_L22_AERO_info/raw/master/to_Gitbook/content/IO_UAV_Day2_with_Landing_150x.mp4">
<!-- <source id="vs1" ></source> -->
</video>
<p><i>Примеры распознавание маркеров</i></p>
